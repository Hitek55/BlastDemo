window.__require=function e(t,o,i){function r(s,a){if(!o[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var p=o[s]={exports:{}};t[s][0].call(p.exports,function(e){return r(t[s][1][e]||e)},p,p.exports,e,t,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)r(i[s]);return r}({BlastGame:[function(e,t,o){"use strict";cc._RF.push(t,"8d5c8FMdAhLxpDMXDa/KDWV","BlastGame");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./Controller/GameController"),a=e("./View/GameLayoutManager"),c=cc._decorator,l=c.ccclass,p=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gameController=null,t.layoutManager=null,t}return r(t,e),t.prototype.start=function(){this.setupCanvas()},t.prototype.setupCanvas=function(){var e=this.node.getComponent(cc.Canvas);e&&(e.fitHeight=!0,e.fitWidth=!0,cc.view.setDesignResolutionSize(e.designResolution.width,e.designResolution.height,cc.ResolutionPolicy.SHOW_ALL))},n([p(s.default)],t.prototype,"gameController",void 0),n([p(a.default)],t.prototype,"layoutManager",void 0),n([l],t)}(cc.Component);o.default=u,cc._RF.pop()},{"./Controller/GameController":"GameController","./View/GameLayoutManager":"GameLayoutManager"}],BoosterType:[function(e,t,o){"use strict";var i;cc._RF.push(t,"1a3eaQRQABEUKaW3hOv5arl","BoosterType"),Object.defineProperty(o,"__esModule",{value:!0}),o.isValidBooster=o.BoosterType=void 0,function(e){e[e.BOMB=0]="BOMB",e[e.TELEPORT=1]="TELEPORT"}(i=o.BoosterType||(o.BoosterType={})),o.isValidBooster=function(e){return e>=i.BOMB&&e<=i.TELEPORT},cc._RF.pop()},{}],Booster:[function(e,t,o){"use strict";cc._RF.push(t,"017d5OOyJZKeroS8q7uSC0J","Booster"),Object.defineProperty(o,"__esModule",{value:!0}),o.Booster=void 0;var i=function(){function e(e,t,o){this._type=e,this._row=t,this._col=o}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"row",{get:function(){return this._row},set:function(e){this._row=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},set:function(e){this._col=e},enumerable:!1,configurable:!0}),e}();o.Booster=i,cc._RF.pop()},{}],ExplosionManager:[function(e,t,o){"use strict";cc._RF.push(t,"5b279UISE5MiaNR6U4NYtrK","ExplosionManager");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./TileFragment"),a=cc._decorator,c=a.ccclass,l=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fragmentsCount=9,t.explosionDuration=.3,t.explosionForce=700,t.upwardForce=400,t.rotationSpeed=360,t._fragmentsPool=[],t._poolSize=100,t}return r(t,e),t.prototype.onLoad=function(){this.initFragmentsPool()},t.prototype.initFragmentsPool=function(){for(var e=0;e<this._poolSize;e++){var t=this.createFragmentNode();t.active=!1,this._fragmentsPool.push(t)}},t.prototype.createFragmentNode=function(){var e=new cc.Node("TileFragment");return e.parent=this.node,e.addComponent(s.default),e},t.prototype.getFragmentFromPool=function(){for(var e=0;e<this._fragmentsPool.length;e++)if(!this._fragmentsPool[e].active)return this._fragmentsPool[e];var t=this.createFragmentNode();return this._fragmentsPool.push(t),t},t.prototype.createExplosion=function(e,t,o){if(e&&t){for(var i=e.parent.convertToWorldSpaceAR(cc.v2(e.x,e.y)),r=this.node.convertToNodeSpaceAR(i),n=e.width,a=e.height,c=Math.floor(Math.sqrt(this.fragmentsCount)),l=Math.ceil(this.fragmentsCount/c),p=n/c*2,u=a/l*2,h=0,f=0,d=0;d<l;d++)for(var _=0;_<c&&!(h>=this.fragmentsCount);_++){var y=(_-(c-1)/2)*p,T=(d-(l-1)/2)*u,m=this.getFragmentFromPool();m.active=!0;var v=_/c*n,g=d/l*a,b=m.getComponent(s.default);if(b){b.init(t,r.x+y,r.y+T,p,u,v,g);var B=Math.random()*Math.PI*2,w=this.explosionForce*(.5+.5*Math.random()),S=this.upwardForce*(.7+.6*Math.random()),O=Math.cos(B)*w,E=Math.sin(B)*w+S,R=(Math.random()>.5?1:-1)*this.rotationSpeed*(.5+.5*Math.random());b.playExplosionAnimation(O,E,R,this.explosionDuration,function(){++f===h&&o&&o()}),h++}}0===h&&o&&o()}else o&&o()},n([l],t.prototype,"fragmentsCount",void 0),n([l],t.prototype,"explosionDuration",void 0),n([l],t.prototype,"explosionForce",void 0),n([l],t.prototype,"upwardForce",void 0),n([l],t.prototype,"rotationSpeed",void 0),n([c],t)}(cc.Component);o.default=p,cc._RF.pop()},{"./TileFragment":"TileFragment"}],ExplosionType:[function(e,t,o){"use strict";cc._RF.push(t,"82be0DTAl5DQpdyN7vbPUHf","ExplosionType"),Object.defineProperty(o,"__esModule",{value:!0}),o.ExplosionType=void 0,function(e){e[e.BOMB=0]="BOMB",e[e.ROW=1]="ROW",e[e.COLUMN=2]="COLUMN"}(o.ExplosionType||(o.ExplosionType={})),cc._RF.pop()},{}],GameBoardView:[function(e,t,o){"use strict";cc._RF.push(t,"e9ee0NZdHVKCKgJ7e964Q3n","GameBoardView");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var n=arguments[t],s=0,a=n.length;s<a;s++,r++)i[r]=n[s];return i};Object.defineProperty(o,"__esModule",{value:!0});var a=e("../Model/GameConfig"),c=e("./TileView"),l=e("./ExplosionManager"),p=cc._decorator,u=p.ccclass,h=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tilePrefab=null,t.tileSprites=[],t.initialPoolSize=100,t.explosionManager=null,t._tileViews=[],t._gameBoard=null,t._isAnimating=!1,t._tilePool=[],t}return r(t,e),t.prototype.startAnimation=function(){this._isAnimating=!0},t.prototype.endAnimation=function(e){this._isAnimating=!1,e&&e()},t.prototype.createAnimationCounter=function(e,t){var o=this,i=e;return{decrease:function(){--i<=0&&o.endAnimation(t)},complete:function(){return i<=0}}},t.prototype.calculateBoardPositions=function(){var e=this._gameBoard.rows,t=this._gameBoard.cols,o=a.GameConfig.TILE_SIZE,i=t*o,r=e*o;return{startX:-i/2+o/2,startY:r/2-o/2,boardWidth:i,boardHeight:r}},t.prototype.getTilePosition=function(e,t){var o=this.calculateBoardPositions(),i=o.startX,r=o.startY,n=a.GameConfig.TILE_SIZE;return{x:i+t*n,y:r-e*n}},t.prototype.createTileExplosion=function(e,t){if(e&&e.node&&e.sprite&&e.sprite.spriteFrame){var o=cc.instantiate(e.node);o.parent=this.node,o.position=e.node.position,o.scale=e.node.scale,o.opacity=0,e.node.scale=0,e.node.opacity=0,e.node.active=!1,this.explosionManager.createExplosion(o,e.sprite.spriteFrame,function(){o&&o.isValid&&o.removeFromParent(!0),t&&t()})}else t&&t()},t.prototype.createFlyingTile=function(e,t,o,i){if(e&&e.node){var r=e.node.scale;e.node.scale=0,e.node.opacity=0;var n=cc.instantiate(e.node);n.parent=this.node,n.position=e.node.position,n.scale=r,n.opacity=255;var s=n.getComponent(c.default);s?s.playFlyToAnimation(t,o,function(){n.removeFromParent(!0),i&&i()}):(n.removeFromParent(!0),i&&i())}else i&&i()},t.prototype.onLoad=function(){cc.view.on("canvas-resize",this.adaptToScreenSize,this),this.initTilePool()},t.prototype.initTilePool=function(){if(this.tilePrefab)for(var e=0;e<this.initialPoolSize;e++){var t=cc.instantiate(this.tilePrefab);t.parent=this.node,t.active=!1;var o=t.getComponent(c.default);o&&(o.tileSprites=this.tileSprites),this._tilePool.push(t)}},t.prototype.getTileFromPool=function(){if(this._tilePool.length>0){var e=this._tilePool.pop();return e.active=!0,e.scale=1,e}if(!this.tilePrefab)return null;var t=cc.instantiate(this.tilePrefab);t.parent=this.node,t.scale=1;var o=t.getComponent(c.default);return o&&(o.tileSprites=this.tileSprites),t},t.prototype.returnTileToPool=function(e){e.active=!1,e.scale=0,this._tilePool.push(e)},t.prototype.adaptToScreenSize=function(){if(this._gameBoard){var e=this._gameBoard.rows,t=this._gameBoard.cols,o=a.GameConfig.TILE_SIZE,i=t*o,r=e*o,n=cc.view.getVisibleSize(),s=.9*n.width/i,c=.9*n.height/r,l=Math.min(s,c);this.node.scale=l}},t.prototype.init=function(e){this._gameBoard=e,this.createTileViews(),this.adaptToScreenSize()},t.prototype.createTileViews=function(){for(var e,t=this,o=0;o<this._tileViews.length;o++)for(var i=0;i<(null===(e=this._tileViews[o])||void 0===e?void 0:e.length);i++){var r=this._tileViews[o][i];r&&r.node&&this.returnTileToPool(r.node)}if(this._tileViews=[],this._gameBoard){var n=this._gameBoard.rows,s=this._gameBoard.cols,l=a.GameConfig.TILE_SIZE,p=-s*l/2+l/2,u=n*l/2-l/2;for(o=0;o<n;o++){this._tileViews[o]=[];var h=function(e){var i=f._gameBoard.getTile(o,e);if(i){var r=f.getTileFromPool();r.x=p+e*l,r.y=u-o*l;var n=r.getComponent(c.default);n?(n.init(i.type,o,e),r.off(cc.Node.EventType.TOUCH_END),r.on(cc.Node.EventType.TOUCH_END,function(){n&&t.onTileClicked(n.row,n.col)}),f._tileViews[o][e]=n):f._tileViews[o][e]=null}else f._tileViews[o][e]=null},f=this;for(i=0;i<s;i++)h(i)}}},t.prototype.onTileClicked=function(e,t){this._isAnimating||this.node.emit("tile-clicked",{row:e,col:t})},t.prototype.updateBoard=function(){if(this._gameBoard)for(var e=this._gameBoard.rows,t=this._gameBoard.cols,o=0;o<e;o++)for(var i=0;i<t;i++){var r=this._gameBoard.getTile(o,i),n=this._tileViews[o][i];r&&n&&(n.init(r.type,o,i),r.isSuperTile()?n.node.zIndex=10:n.node.zIndex=0)}},t.prototype.animateChainExplosion=function(e,t,o){var i=this;this.startAnimation();var r=0,n=void 0!==o?o:this.determineWaveDelayFromTiles(e),s=function(){if(r>=e.length)i.endAnimation(t);else{var o=e[r];i.animateWaveExplosion(o,function(){r++,i.scheduleOnce(function(){s()},n/1e3)})}};s()},t.prototype.determineWaveDelayFromTiles=function(e){if(0===e.length||0===e[0].length)return 0;var t=e[0];return e.reduce(function(e,t){return e+t.length},0)>=this._gameBoard.rows*this._gameBoard.cols*.8?0:(t.length,0)},t.prototype.animateWaveExplosion=function(e,t){var o=this;if(0!==e.length){for(var i=new Map,r=0,n=0,s=e;n<s.length;n++){var a=s[n],c=this._tileViews[a.row][a.col];if(!(!c||!c.node||!c.node.isValid||c.node.scale<=0||c.node.opacity<=0)&&c.sprite&&c.sprite.spriteFrame){var l=a.type;i.has(l)||i.set(l,[]),i.get(l).push({tile:a,view:c}),r++}}if(0!==r){var p=this.createAnimationCounter(r,t);i.forEach(function(e){if(e.length>0&&o.explosionManager){var t=e[0].view.sprite.spriteFrame;e.forEach(function(e){var i=e.tile,r=e.view,n={x:r.node.x,y:r.node.y};r.node.scale=0,r.node.opacity=0,r.node.active=!1,o.explosionManager.createExplosion({parent:o.node,x:n.x,y:n.y,width:r.node.width,height:r.node.height},t,p.decrease),o.returnTileToPool(r.node),o._tileViews[i.row][i.col]=null})}})}else t&&t()}else t&&t()},t.prototype.animateRemoveTiles=function(e,t,o){var i=this;this.startAnimation();var r=s(e).map(function(e){return{row:e.row,col:e.col,type:e.type,tileView:i._tileViews[e.row][e.col]}}),n=null,a=null;if(t)if(this._tileViews[t.row]&&this._tileViews[t.row][t.col]){var c=this._tileViews[t.row][t.col];n=c.node.x,a=c.node.y}else{var l=this.getTilePosition(t.row,t.col);n=l.x,a=l.y}var p=r.filter(function(e){return null!=e.tileView});if(0!==p.length){var u=this.createAnimationCounter(p.length,o);p.forEach(function(e){var o=e.row,r=e.col,s=e.tileView;!t||o===t.row&&r===t.col?i.createTileExplosion(s,function(){i.returnTileToPool(s.node),i._tileViews[o][r]=null,u.decrease()}):i.createFlyingTile(s,n,a,function(){i.returnTileToPool(s.node),i._tileViews[o][r]=null,u.decrease()})})}else this.endAnimation(o)},t.prototype.animateFallingTiles=function(e){var t=this;this.startAnimation();for(var o=this._gameBoard.rows,i=this._gameBoard.cols,r=(this.calculateBoardPositions().startY,Array(o).fill(null).map(function(e,o){return Array(i).fill(null).map(function(e,i){return t._tileViews[o][i]})})),n=0;n<o;n++)for(var s=0;s<i;s++)this._tileViews[n][s]=null;var a=0;for(s=0;s<i;s++){var c=[];for(n=0;n<o;n++)(h=r[n][s])&&c.push({view:h,oldRow:n});for(var l=o-1,p=c.length-1;p>=0;p--){var u=c[p],h=u.view,f=u.oldRow;this._tileViews[l][s]=h;var d=this._gameBoard.getTile(l,s);if(d?h.init(d.type,l,s):(h.row=l,h.col=s),f!==l){var _=this.getTilePosition(l,s);a++,h.playFallAnimation(_.y,function(){0==--a&&t.endAnimation(e)})}l--}}0===a&&this.endAnimation(e)},t.prototype.animateNewTiles=function(e){var t=this;this.startAnimation();for(var o=this._gameBoard.rows,i=this._gameBoard.cols,r=0,n=[],s=0;s<o;s++)for(var a=0;a<i;a++){var l=this._gameBoard.getTile(s,a);l&&!this._tileViews[s][a]&&(n.push({row:s,col:a,tile:l}),r++)}if(0!==r){var p=this.createAnimationCounter(r,e);n.forEach(function(e){var o=e.row,i=e.col,r=e.tile,n=t.getTileFromPool(),s=t.getTilePosition(o,i);n.x=s.x,n.y=s.y;var a=n.getComponent(c.default);a?(a.init(r.type,o,i),n.off(cc.Node.EventType.TOUCH_END),n.on(cc.Node.EventType.TOUCH_END,function(){a&&t.onTileClicked(a.row,a.col)}),t._tileViews[o][i]=a,a.playNewTileAnimation(p.decrease)):(t.returnTileToPool(n),p.decrease())})}else this.endAnimation(e)},t.prototype.isAnimating=function(){return this._isAnimating},t.prototype.highlightTile=function(e,t,o){var i=this._tileViews[e][t];i&&(o?(i.node.scale=1.2,i.node.opacity=200):(i.node.scale=1,i.node.opacity=255))},t.prototype.clearHighlights=function(){for(var e=0;e<this._tileViews.length;e++)for(var t=0;t<this._tileViews[e].length;t++){var o=this._tileViews[e][t];o&&(o.node.scale=1,o.node.opacity=255)}},t.prototype.animateSuperTileCreation=function(e,t){var o=this._gameBoard.getTile(e,t);if(o){var i=this._tileViews[e][t];if(i){i.node.zIndex=10;var r=cc.sequence(cc.scaleTo(.2,0),cc.callFunc(function(){i.init(o.type,e,t)}),cc.scaleTo(.3,1.3).easing(cc.easeBackOut()),cc.scaleTo(.1,1));i.node.runAction(r)}}},t.prototype.animateTeleport=function(e,t,o,i,r){var n=this;this.startAnimation();var s=this._gameBoard.getTile(e,t),a=this._gameBoard.getTile(o,i);if(s&&a){var c=this._tileViews[e][t],l=this._tileViews[o][i];if(c&&l){var p=cc.v2(c.node.x,c.node.y),u=cc.v2(l.node.x,l.node.y),h=cc.instantiate(c.node),f=cc.instantiate(l.node);h.parent=this.node,f.parent=this.node,h.x=p.x,h.y=p.y,f.x=u.x,f.y=u.y,c.node.opacity=0,l.node.opacity=0;var d=cc.sequence(cc.scaleTo(.15,1.2),cc.spawn(cc.moveTo(.3,u).easing(cc.easeInOut(2)),cc.sequence(cc.fadeTo(.15,150),cc.fadeTo(.15,255))),cc.scaleTo(.15,1)),_=cc.sequence(cc.scaleTo(.15,1.2),cc.spawn(cc.moveTo(.3,p).easing(cc.easeInOut(2)),cc.sequence(cc.fadeTo(.15,150),cc.fadeTo(.15,255))),cc.scaleTo(.15,1),cc.callFunc(function(){h.removeFromParent(!0),f.removeFromParent(!0),c.init(s.type,e,t),l.init(a.type,o,i),c.node.opacity=255,l.node.opacity=255,n.endAnimation(r)}));h.runAction(d),f.runAction(_)}else this.endAnimation(r)}else this.endAnimation(r)},t.prototype.animateShuffle=function(e){var t=this;if(this._gameBoard){this.startAnimation();for(var o=this._gameBoard.rows,i=this._gameBoard.cols,r=(a.GameConfig.TILE_SIZE,[]),n=0;n<o;n++)for(var s=0;s<i;s++){var c=this._tileViews[n][s],l=this._gameBoard.getTile(n,s);c&&l&&(c.init(l.type,n,s),r.push(c))}if(0!==r.length){var p=this.createAnimationCounter(r.length,function(){t.updateBoard(),e&&e()});r.forEach(function(e){var t=Math.floor(10*Math.random());e.node.zIndex=t;var o=cc.sequence(cc.scaleTo(.2,0),cc.scaleTo(.3,1.2).easing(cc.easeBackOut()),cc.scaleTo(.1,1),cc.callFunc(function(){e.node.zIndex=0,p.decrease()}));e.node.runAction(cc.sequence(cc.delayTime(.3*Math.random()),o))})}else this.endAnimation(e)}else e&&e()},t.prototype.getTileViewAt=function(e,t){return e>=0&&e<this._tileViews.length&&t>=0&&this._tileViews[e]&&t<this._tileViews[e].length?this._tileViews[e][t]:null},t.prototype.getTileWorldPosition=function(e,t){var o=this.getTileViewAt(e,t);if(o&&o.node)return this.node.convertToWorldSpaceAR(o.node.position);var i=a.GameConfig.TILE_SIZE,r=this._gameBoard.rows,n=-this._gameBoard.cols*i/2+i/2+t*i,s=r*i/2-i/2-e*i,c=this.node.convertToWorldSpaceAR(cc.v2(n,s));return cc.v3(c.x,c.y,0)},t.prototype.animateBombFlight=function(e,t,o){var i=this,r=new cc.Node("FlyingBomb");r.parent=cc.director.getScene();var n=cc.director.getScene().convertToNodeSpaceAR(e),s=cc.director.getScene().convertToNodeSpaceAR(t);r.position=cc.v3(n.x,n.y,0),r.addComponent(cc.Sprite).spriteFrame=this.tileSprites[7],r.width=a.GameConfig.TILE_SIZE,r.height=a.GameConfig.TILE_SIZE,r.zIndex=1e3;var c=cc.Vec3.distance(cc.v3(n.x,n.y,0),cc.v3(s.x,s.y,0)),l=Math.min(.8,.3+c/2e3),p=cc.v3((n.x+s.x)/2,Math.max(n.y,s.y)+200,0),u=[cc.v2((n.x+p.x)/2,p.y),cc.v2((p.x+s.x)/2,p.y),cc.v2(s.x,s.y)],h=cc.bezierTo(l,u),f=cc.rotateBy(l,360),d=cc.sequence(cc.spawn(h,f),cc.callFunc(function(){o&&o();var e=cc.sequence(cc.scaleTo(.2,1.2),cc.scaleTo(.2,1)).repeat(2);r.runAction(e),i.scheduleOnce(function(){r.runAction(cc.sequence(cc.spawn(cc.scaleTo(.2,2),cc.fadeOut(.2)),cc.callFunc(function(){r.removeFromParent(!0)})))},.8)}));r.runAction(d)},n([h(cc.Prefab)],t.prototype,"tilePrefab",void 0),n([h([cc.SpriteFrame])],t.prototype,"tileSprites",void 0),n([h],t.prototype,"initialPoolSize",void 0),n([h(l.default)],t.prototype,"explosionManager",void 0),n([u],t)}(cc.Component);o.default=f,cc._RF.pop()},{"../Model/GameConfig":"GameConfig","./ExplosionManager":"ExplosionManager","./TileView":"TileView"}],GameBoard:[function(e,t,o){"use strict";cc._RF.push(t,"90c05mRmrRE36QYNzV564Cm","GameBoard"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameBoard=void 0;var i=e("./Tile"),r=e("../Enums/TileType"),n=e("./GameConfig"),s=e("../Enums/ExplosionType"),a=function(){function e(e,t){void 0===e&&(e=n.GameConfig.GRID_ROWS),void 0===t&&(t=n.GameConfig.GRID_COLS),this._selectedTile=null,this._rows=e,this._cols=t,this._grid=[],this.initializeGrid()}return Object.defineProperty(e.prototype,"grid",{get:function(){return this._grid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cols",{get:function(){return this._cols},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedTile",{get:function(){return this._selectedTile},set:function(e){this._selectedTile&&(this._selectedTile.isSelected=!1),this._selectedTile=e,this._selectedTile&&(this._selectedTile.isSelected=!0)},enumerable:!1,configurable:!0}),e.prototype.initializeGrid=function(){this._grid=[];for(var e=0;e<this._rows;e++){this._grid[e]=[];for(var t=0;t<this._cols;t++){var o=r.getRandomTileType();this._grid[e][t]=new i.Tile(o,e,t)}}},e.prototype.addInitialSuperTiles=function(){for(var e=0,t=[r.TileType.SUPER_ROW,r.TileType.SUPER_COLUMN,r.TileType.SUPER_BOMB,r.TileType.SUPER_TNT];e<t.length;e++)for(var o=t[e],n=!1;!n;){var s=Math.floor(Math.random()*this._rows),a=Math.floor(Math.random()*this._cols),c=this._grid[s][a];c&&r.isRegularTile(c.type)&&(this._grid[s][a]=new i.Tile(o,s,a),n=!0)}},e.prototype.getTile=function(e,t){return this.isValidPosition(e,t)?this._grid[e][t]:null},e.prototype.isValidPosition=function(e,t){return e>=0&&e<this._rows&&t>=0&&t<this._cols},e.prototype.findConnectedTiles=function(e,t){var o=this,i=this.getTile(e,t);if(!i||!i.isRegular())return[];var r=[],n=Array(this._rows).fill(0).map(function(){return Array(o._cols).fill(!1)}),s=function(e,t){if(o.isValidPosition(e,t)&&!n[e][t]){var a=o.getTile(e,t);if(a&&i.isSameType(a)){n[e][t]=!0,r.push(a);for(var c=0,l=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}];c<l.length;c++){var p=l[c];s(e+p.dr,t+p.dc)}}}};return s(e,t),r},e.prototype.removeTiles=function(e){var t=this;e.forEach(function(e){t.isValidPosition(e.row,e.col)&&(t._grid[e.row][e.col]=null)})},e.prototype.applyGravity=function(){for(var e=0;e<this._cols;e++)for(var t=-1,o=this._rows-1;o>=0;o--)if(null===this._grid[o][e])-1===t&&(t=o);else if(-1!==t){var i=this._grid[o][e];this._grid[t][e]=i,this._grid[o][e]=null,i&&(i.row=t),t--}},e.prototype.fillEmptyCells=function(){for(var e=0;e<this._cols;e++)for(var t=0;t<this._rows;t++)if(null===this._grid[t][e]){var o=r.getRandomTileType();this._grid[t][e]=new i.Tile(o,t,e)}},e.prototype.hasValidMoves=function(){for(var e=0;e<this._rows;e++)for(var t=0;t<this._cols;t++){var o=this.getTile(e,t);if(o&&o.isRegular()){if(this.findConnectedTiles(e,t).length>=n.GameConfig.MIN_TILES_TO_BLAST)return!0}else if(o&&o.isSuperTile())return!0}return!1},e.prototype.shuffleGrid=function(){for(var e=[],t=0;t<this._rows;t++)for(var o=0;o<this._cols;o++)(n=this._grid[t][o])&&n.isRegular()&&e.push(n);var i=e.map(function(e){return e.type});this.shuffleArray(i);for(var r=0;r<e.length;r++)e[r].type=i[r];for(t=0;t<this._rows;t++)for(o=0;o<this._cols;o++){var n;(n=this._grid[t][o])&&(n.row=t,n.col=o)}},e.prototype.shuffleArray=function(e){for(var t,o=e.length-1;o>0;o--){var i=Math.floor(Math.random()*(o+1));t=[e[i],e[o]],e[o]=t[0],e[i]=t[1]}},e.prototype.createSuperTile=function(e,t){if(!this.isValidPosition(e,t))return null;var o=r.getRandomSuperTileType(),n=new i.Tile(o,e,t);return this._grid[e][t]=n,n},e.prototype.activateSuperTile=function(e,t){var o=this.getTile(e,t);if(!o||!o.isSuperTile())return[];var i=[];switch(i.push(o),o.type){case r.TileType.SUPER_ROW:for(var s=0;s<this._cols;s++){var a=this.getTile(e,s);a&&!a.isSuperTile()&&i.push(a)}break;case r.TileType.SUPER_COLUMN:for(var c=0;c<this._rows;c++){var l=this.getTile(c,t);l&&!l.isSuperTile()&&i.push(l)}break;case r.TileType.SUPER_BOMB:var p=n.GameConfig.BOMB_RADIUS;for(c=e-p;c<=e+p;c++)for(s=t-p;s<=t+p;s++)if(this.isValidPosition(c,s)){var u=this.getTile(c,s);u&&!u.isSuperTile()&&i.push(u)}break;case r.TileType.SUPER_TNT:for(c=0;c<this._rows;c++)for(s=0;s<this._cols;s++){var h=this.getTile(c,s);h&&!h.isSuperTile()&&i.push(h)}}return i},e.prototype.calculateExplosionWaves=function(e,t,o){var i,r=[],n=this.getTile(e,t);switch(n&&r.push([n]),o){case s.ExplosionType.BOMB:return i=Math.max(Math.max(e,this._rows-1-e),Math.max(t,this._cols-1-t))+1,this.calculateBombWaves(r,e,t,i);case s.ExplosionType.ROW:return i=Math.max(t,this._cols-1-t),this.calculateRowWaves(r,e,t,i);case s.ExplosionType.COLUMN:return i=Math.max(e,this._rows-1-e),this.calculateColumnWaves(r,e,t,i)}},e.prototype.calculateBombWaves=function(e,t,o,i){var r=new Set;r.add(t+"_"+o);for(var n=0;n<=i;n++){for(var s=[],a=0;a<this._rows;a++)for(var c=0;c<this._cols;c++){var l=a+"_"+c;if(!r.has(l)){var p=Math.abs(a-t),u=Math.abs(c-o);if(Math.max(p,u)===n){var h=this.getTile(a,c);h&&!h.isSuperTile()?(s.push(h),r.add(l)):h&&h.isSuperTile()&&r.add(l)}}}s.length>0&&e.push(s)}return e},e.prototype.calculateRowWaves=function(e,t,o,i){var r=new Set;r.add(o);for(var n=0;n<=i;n++){for(var s=[],a=0;a<this._cols;a++)if(!r.has(a)&&Math.abs(a-o)===n){var c=this.getTile(t,a);c&&!c.isSuperTile()?(s.push(c),r.add(a)):c&&c.isSuperTile()&&r.add(a)}s.length>0&&e.push(s)}return e},e.prototype.calculateColumnWaves=function(e,t,o,i){var r=new Set;r.add(t);for(var n=0;n<=i;n++){for(var s=[],a=0;a<this._rows;a++)if(!r.has(a)&&Math.abs(a-t)===n){var c=this.getTile(a,o);c&&!c.isSuperTile()?(s.push(c),r.add(a)):c&&c.isSuperTile()&&r.add(a)}s.length>0&&e.push(s)}return e},e.prototype.activateBombBooster=function(e,t){for(var o=[],i=n.GameConfig.BOMB_RADIUS,r=e-i;r<=e+i;r++)for(var s=t-i;s<=t+i;s++)if(this.isValidPosition(r,s)){var a=this.getTile(r,s);a&&o.push(a)}return o},e.prototype.selectTileForTeleport=function(e,t){var o=this.getTile(e,t);return!(!o||o.isSuperTile()||(this.selectedTile=o,0))},e.prototype.teleportTiles=function(e,t){if(!this._selectedTile)return!1;var o=this.getTile(e,t);if(!o||o.isSuperTile())return!1;if(this._selectedTile.row===e&&this._selectedTile.col===t)return!1;var i=this._selectedTile.row,r=this._selectedTile.col;return this._grid[i][r]=o,this._grid[e][t]=this._selectedTile,o.row=i,o.col=r,this._selectedTile.row=e,this._selectedTile.col=t,this.selectedTile=null,!0},e.prototype.findFreePositionForBooster=function(){for(var e=0;e<this._rows;e++)for(var t=0;t<this._cols;t++){var o=this.getTile(e,t);if(!o||o.isRegular())return{row:e,col:t}}return null},e}();o.GameBoard=a,cc._RF.pop()},{"../Enums/ExplosionType":"ExplosionType","../Enums/TileType":"TileType","./GameConfig":"GameConfig","./Tile":"Tile"}],GameConfig:[function(e,t,o){"use strict";cc._RF.push(t,"b1cf4AIXkBH+qEjJaMfhcw6","GameConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfig=void 0;var i=function(){function e(){}return e.getScoreForTiles=function(e){return 10*e},e.GRID_ROWS=9,e.GRID_COLS=9,e.TILE_SIZE=64,e.TARGET_SCORE=5e3,e.MAX_MOVES=30,e.BOMB_BOOSTERS_COUNT=5,e.TELEPORT_BOOSTERS_COUNT=5,e.MIN_TILES_TO_BLAST=2,e.MAX_SHUFFLES=3,e.BOMB_RADIUS=2,e.TILE_COUNT_FOR_SUPER_TILE=4,e}();o.GameConfig=i,cc._RF.pop()},{}],GameController:[function(e,t,o){"use strict";cc._RF.push(t,"3b28dFtjkZBnYyS7QWN1Cd0","GameController");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../Model/GameModel"),a=e("../Enums/BoosterType"),c=e("../View/GameBoardView"),l=e("../View/UIView"),p=cc._decorator,u=p.ccclass,h=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.boardView=null,t.uiView=null,t.boosterBombButton=null,t.boosterTeleportButton=null,t._gameModel=null,t}return r(t,e),t.prototype.onLoad=function(){this._gameModel=new s.GameModel,this._gameModel.setObserver(this),this.boardView&&(this.boardView.init(this._gameModel.board),this.boardView.node.on("tile-clicked",this.onTileClicked,this)),this.uiView&&(this.uiView.updateBombBoosters(this._gameModel.bombBoostersLeft),this.uiView.updateTeleportBoosters(this._gameModel.teleportBoostersLeft),this.updateBoosterButtonsState()),this.setupBoosterButtons(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},t.prototype.onKeyDown=function(e){49===e.keyCode&&this.shuffleBoardWithAnimation()},t.prototype.shuffleBoardWithAnimation=function(){this.boardView&&!this.boardView.isAnimating()&&this._gameModel.shuffleBoardWithAnimation()},t.prototype.setupBoosterButtons=function(){this.boosterBombButton&&this.boosterBombButton.on(cc.Node.EventType.TOUCH_END,this.onBoosterBombClicked,this),this.boosterTeleportButton&&this.boosterTeleportButton.on(cc.Node.EventType.TOUCH_END,this.onBoosterTeleportClicked,this)},t.prototype.onTileClicked=function(e){var t=e.row,o=e.col;this.boardView&&this.boardView.isAnimating()||this._gameModel.handleTileClick(t,o)&&this.boardView&&this.boardView.updateBoard()},t.prototype.onBoosterBombClicked=function(){this.boardView&&this.boardView.isAnimating()||this._gameModel.gameState===s.GameState.GAME_OVER||this._gameModel.gameState===s.GameState.ANIMATION_RUNNING||this.boosterBombButton.getComponent(cc.Button).interactable&&this._gameModel.activateBoosterMode(a.BoosterType.BOMB)&&this.updateBoosterButtonsState()},t.prototype.onBoosterTeleportClicked=function(){this.boardView&&this.boardView.isAnimating()||this._gameModel.gameState===s.GameState.GAME_OVER||this._gameModel.gameState===s.GameState.ANIMATION_RUNNING||this.boosterTeleportButton.getComponent(cc.Button).interactable&&this._gameModel.activateBoosterMode(a.BoosterType.TELEPORT)&&this.updateBoosterButtonsState()},t.prototype.onScoreChanged=function(e){this.uiView&&this.uiView.updateScore(e)},t.prototype.onMovesChanged=function(e){this.uiView&&this.uiView.updateMoves(e)},t.prototype.onBombBoostersChanged=function(e){this.uiView&&(this.uiView.updateBombBoosters(e),this.updateBoosterButtonsState())},t.prototype.onTeleportBoostersChanged=function(e){this.uiView&&(this.uiView.updateTeleportBoosters(e),this.updateBoosterButtonsState())},t.prototype.onBoosterHintCleared=function(){this.uiView&&(this.uiView.clearBoosterHint(),this.updateBoosterButtonsState())},t.prototype.updateBoosterButtonsState=function(){var e,t=this._gameModel.gameState,o=this._gameModel.bombBoostersLeft,i=this._gameModel.teleportBoostersLeft;if(this.boosterBombButton&&(e=this.boosterBombButton.getComponent(cc.Button))){var r=o>0&&t!==s.GameState.SELECTING_TELEPORT;e.interactable=r,this.boosterBombButton.opacity=r?255:128}this.boosterTeleportButton&&(e=this.boosterTeleportButton.getComponent(cc.Button))&&(r=i>0&&t!==s.GameState.USING_BOMB,e.interactable=r,this.boosterTeleportButton.opacity=r?255:128)},t.prototype.onGameWon=function(){this.uiView&&this.uiView.showGameOver(!0)},t.prototype.onGameLost=function(){this.uiView&&this.uiView.showGameOver(!1)},t.prototype.onTilesRemoved=function(e){var t=this;if(this.boardView){var o=this._gameModel.pendingSuperTilePosition;this.boardView.animateRemoveTiles(e,o,function(){t._gameModel&&t._gameModel.completeRemoveTiles()})}},t.prototype.onChainExplosion=function(e){var t=this;this.boardView&&this.boardView.animateChainExplosion(e,function(){t._gameModel&&t._gameModel.completeRemoveTiles()})},t.prototype.onTilesFell=function(){var e=this;this.boardView&&(this.boardView.updateBoard(),this.boardView.animateFallingTiles(function(){e._gameModel&&e._gameModel.completeTilesFall()}))},t.prototype.onNewTilesAdded=function(){var e=this;this.boardView&&(this.boardView.updateBoard(),this.boardView.animateNewTiles(function(){e._gameModel&&(e._gameModel.completeNewTilesAdded(),e.boardView.updateBoard())}))},t.prototype.onShuffled=function(){var e=this;this.boardView&&(this.boardView.updateBoard(),this.boardView.animateShuffle(function(){e._gameModel.gameState!==s.GameState.GAME_OVER&&e._gameModel.gameState!==s.GameState.ANIMATION_RUNNING||e._gameModel.restoreGameState(),e.boardView.updateBoard()}))},t.prototype.onTileSelected=function(e){this.boardView&&this.boardView.highlightTile(e.row,e.col,!0)},t.prototype.onTileDeselected=function(){this.boardView&&this.boardView.clearHighlights()},t.prototype.onBoosterActivated=function(e){this.uiView&&this.uiView.showBoosterHint(e)},t.prototype.onTeleportSecondSelection=function(){this.uiView&&this.uiView.updateTeleportSecondHint()},t.prototype.onTeleportAnimation=function(e,t,o,i){var r=this;this.boardView&&this.boardView.animateTeleport(e,t,o,i,function(){r.boardView.updateBoard()})},t.prototype.onSuperTileCreated=function(e){this.boardView&&(this.boardView.updateBoard(),this.boardView.animateSuperTileCreation(e.row,e.col))},t.prototype.onBombPlaced=function(e,t){var o=this;if(this.boardView){var i=this.boosterBombButton.parent.convertToWorldSpaceAR(this.boosterBombButton.position),r=this.boardView.getTileWorldPosition(e,t);this.boardView.animateBombFlight(i,r,function(){o.scheduleOnce(function(){o._gameModel.explodeBomb(e,t)},1)})}},n([h(c.default)],t.prototype,"boardView",void 0),n([h(l.default)],t.prototype,"uiView",void 0),n([h(cc.Node)],t.prototype,"boosterBombButton",void 0),n([h(cc.Node)],t.prototype,"boosterTeleportButton",void 0),n([u],t)}(cc.Component);o.default=f,cc._RF.pop()},{"../Enums/BoosterType":"BoosterType","../Model/GameModel":"GameModel","../View/GameBoardView":"GameBoardView","../View/UIView":"UIView"}],GameLayoutManager:[function(e,t,o){"use strict";cc._RF.push(t,"9fef2s9orpK3rUpNAYj5c5X","GameLayoutManager");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,a=s.ccclass,c=s.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.background=null,t.gameBoard=null,t.uiContainer=null,t}return r(t,e),t.prototype.onLoad=function(){this.adaptLayout(),cc.view.on("canvas-resize",this.adaptLayout,this)},t.prototype.adaptLayout=function(){var e=cc.view.getVisibleSize(),t=this.background.getComponent(cc.Sprite).spriteFrame.getOriginalSize(),o=t.width/t.height;e.width/e.height>o?(this.background.width=e.width,this.background.height=e.width/o):(this.background.height=e.height,this.background.width=e.height*o),this.uiContainer.y=-e.height/2+this.uiContainer.height/2},n([c(cc.Node)],t.prototype,"background",void 0),n([c(cc.Node)],t.prototype,"gameBoard",void 0),n([c(cc.Node)],t.prototype,"uiContainer",void 0),n([a],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],GameModel:[function(e,t,o){"use strict";cc._RF.push(t,"ded79HxqnpNYqHt+Srq7/9U","GameModel");var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var n=arguments[t],s=0,a=n.length;s<a;s++,r++)i[r]=n[s];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.GameModel=o.GameState=void 0;var r,n=e("./GameBoard"),s=e("./GameConfig"),a=e("../Enums/TileType"),c=e("../Enums/BoosterType"),l=e("../Enums/ExplosionType");(function(e){e[e.PLAYING=0]="PLAYING",e[e.SELECTING_TELEPORT=1]="SELECTING_TELEPORT",e[e.USING_BOMB=2]="USING_BOMB",e[e.GAME_OVER=3]="GAME_OVER",e[e.ANIMATION_RUNNING=4]="ANIMATION_RUNNING"})(r=o.GameState||(o.GameState={}));var p=function(){function e(){this._score=0,this._observer=null,this._gameState=r.PLAYING,this._activeBoosterType=null,this._shufflesUsed=0,this._pendingSuperTilePosition=null,this._board=new n.GameBoard,this._movesLeft=s.GameConfig.MAX_MOVES,this._bombBoostersLeft=s.GameConfig.BOMB_BOOSTERS_COUNT,this._teleportBoostersLeft=s.GameConfig.TELEPORT_BOOSTERS_COUNT}return Object.defineProperty(e.prototype,"pendingSuperTilePosition",{get:function(){return this._pendingSuperTilePosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"board",{get:function(){return this._board},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"movesLeft",{get:function(){return this._movesLeft},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bombBoostersLeft",{get:function(){return this._bombBoostersLeft},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"teleportBoostersLeft",{get:function(){return this._teleportBoostersLeft},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gameState",{get:function(){return this._gameState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeBoosterType",{get:function(){return this._activeBoosterType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shufflesUsed",{get:function(){return this._shufflesUsed},enumerable:!1,configurable:!0}),e.prototype.setObserver=function(e){this._observer=e},e.prototype.handleTileClick=function(e,t){if(this._movesLeft<=0||this._gameState===r.GAME_OVER||this._gameState===r.ANIMATION_RUNNING)return!1;var o=this._board.getTile(e,t);if(!o)return!1;switch(this._gameState){case r.PLAYING:return this.handleNormalClick(o);case r.SELECTING_TELEPORT:return this.handleTeleportSelection(o);case r.USING_BOMB:return this.handleBombActivation(o)}return!1},e.prototype.handleNormalClick=function(e){if(e.isSuperTile())return this.activateSuperTile(e);var t=this._board.findConnectedTiles(e.row,e.col);if(t.length<s.GameConfig.MIN_TILES_TO_BLAST)return!1;this._movesLeft--,this.notifyMovesChanged();var o=s.GameConfig.getScoreForTiles(t.length);this._score+=o,this.notifyScoreChanged();var r=i(t);if(t.length>=s.GameConfig.TILE_COUNT_FOR_SUPER_TILE){this._pendingSuperTilePosition={row:e.row,col:e.col};var n=r.filter(function(t){return t.row!==e.row||t.col!==e.col});this.notifyTilesRemoved(n),this._board.removeTiles(n)}else this.notifyTilesRemoved(r),this._board.removeTiles(r);return!0},e.prototype.completeRemoveTiles=function(){if(this._pendingSuperTilePosition){var e=this._pendingSuperTilePosition,t=e.row,o=e.col,i=this._board.createSuperTile(t,o);i&&this.notifySuperTileCreated(i),this._pendingSuperTilePosition=null}this._board.applyGravity(),this.notifyTilesFell()},e.prototype.completeTilesFall=function(){this._board.fillEmptyCells(),this.notifyNewTilesAdded()},e.prototype.completeNewTilesAdded=function(){this.checkGameState()},e.prototype.activateSuperTile=function(e){if(this._movesLeft--,this.notifyMovesChanged(),e.type===a.TileType.SUPER_TNT||e.type===a.TileType.SUPER_ROW||e.type===a.TileType.SUPER_COLUMN)return this.activateSpecialSuperTile(e);var t=this._board.activateSuperTile(e.row,e.col),o=s.GameConfig.getScoreForTiles(t.length);return this._score+=o,this.notifyScoreChanged(),this._board.removeTiles(t),this.notifyTilesRemoved(t),!0},e.prototype.activateSpecialSuperTile=function(e){var t;switch(e.type){case a.TileType.SUPER_TNT:t=this._board.calculateExplosionWaves(e.row,e.col,l.ExplosionType.BOMB);break;case a.TileType.SUPER_ROW:t=this._board.calculateExplosionWaves(e.row,e.col,l.ExplosionType.ROW);break;case a.TileType.SUPER_COLUMN:t=this._board.calculateExplosionWaves(e.row,e.col,l.ExplosionType.COLUMN);break;default:return!1}var o=[];t.forEach(function(e){o.push.apply(o,e)});var i=s.GameConfig.getScoreForTiles(o.length);return this._score+=i,this.notifyScoreChanged(),this._board.removeTiles(o),this.notifyChainExplosion(t),!0},e.prototype.activateBoosterMode=function(e){if(this._gameState===r.GAME_OVER||this._gameState===r.ANIMATION_RUNNING)return!1;if(e===c.BoosterType.BOMB&&this._bombBoostersLeft<=0)return!1;if(e===c.BoosterType.TELEPORT&&this._teleportBoostersLeft<=0)return!1;switch(this._activeBoosterType=e,e){case c.BoosterType.BOMB:this._gameState=r.USING_BOMB;break;case c.BoosterType.TELEPORT:this._gameState=r.SELECTING_TELEPORT}return this.notifyBoosterActivated(e),!0},e.prototype.handleTeleportSelection=function(e){if(!this._board.selectedTile&&this._teleportBoostersLeft<=0)return!1;if(!this._board.selectedTile)return!!this._board.selectTileForTeleport(e.row,e.col)&&(this.notifyTileSelected(e),this.notifyTeleportSecondSelection(),!0);var t=this._board.selectedTile,o=t.row,i=t.col,n=e.row,s=e.col;return!(o===n&&i===s||!this._board.teleportTiles(e.row,e.col)||(this._teleportBoostersLeft--,this.notifyTeleportBoostersChanged(),this._gameState=r.PLAYING,this._activeBoosterType=null,this.notifyTileDeselected(),this.notifyBoosterHintCleared(),this.notifyTeleportAnimation(o,i,n,s),this.checkGameState(),0))},e.prototype.notifyTeleportSecondSelection=function(){this._observer&&this._observer.onTeleportSecondSelection&&this._observer.onTeleportSecondSelection()},e.prototype.notifyTeleportAnimation=function(e,t,o,i){this._observer&&this._observer.onTeleportAnimation&&this._observer.onTeleportAnimation(e,t,o,i)},e.prototype.handleBombActivation=function(e){return!(e.isSuperTile()||this._bombBoostersLeft<=0||(this._bombBoostersLeft--,this.notifyBombBoostersChanged(),this.notifyBombPlaced(e.row,e.col),this._gameState=r.PLAYING,this._activeBoosterType=null,this.notifyBoosterHintCleared(),0))},e.prototype.explodeBomb=function(e,t){var o=this._board.activateBombBooster(e,t),i=s.GameConfig.getScoreForTiles(o.length);this._score+=i,this.notifyScoreChanged(),this._board.removeTiles(o),this.notifyTilesRemoved(o)},e.prototype.checkGameState=function(){return this._score>=s.GameConfig.TARGET_SCORE?(this._gameState=r.GAME_OVER,void this.notifyGameWon()):this._board.hasValidMoves()?this._movesLeft<=0?(this._gameState=r.GAME_OVER,this.notifyGameLost(),void console.log("\u0418\u0433\u0440\u0430 \u0437\u0430\u043a\u043e\u043d\u0447\u0435\u043d\u0430, \u043a\u043e\u043d\u0447\u0438\u043b\u0438\u0441\u044c \u0445\u043e\u0434\u044b")):void 0:void(this._shufflesUsed<s.GameConfig.MAX_SHUFFLES?(this._board.shuffleGrid(),this._shufflesUsed++,this.notifyShuffled(),console.log("\u041f\u043e\u043b\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u0448\u0430\u043d\u043e",this._shufflesUsed)):(this._gameState=r.GAME_OVER,this.notifyGameLost(),console.log("\u0418\u0433\u0440\u0430 \u0437\u0430\u043a\u043e\u043d\u0447\u0435\u043d\u0430, \u043f\u043e\u043b\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u0448\u0430\u043d\u043e 3 \u0440\u0430\u0437\u0430")))},e.prototype.shuffleBoardWithAnimation=function(){this._gameState===r.PLAYING&&(this._gameState=r.ANIMATION_RUNNING,this._board.shuffleGrid(),this.notifyShuffled())},e.prototype.restoreGameState=function(){this._gameState=r.PLAYING},e.prototype.notifyScoreChanged=function(){this._observer&&this._observer.onScoreChanged(this._score)},e.prototype.notifyMovesChanged=function(){this._observer&&this._observer.onMovesChanged(this._movesLeft)},e.prototype.notifyGameWon=function(){this._observer&&this._observer.onGameWon()},e.prototype.notifyGameLost=function(){this._observer&&this._observer.onGameLost()},e.prototype.notifyTilesRemoved=function(e){this._observer&&this._observer.onTilesRemoved(e)},e.prototype.notifyChainExplosion=function(e){this._observer&&this._observer.onChainExplosion&&this._observer.onChainExplosion(e)},e.prototype.notifyTilesFell=function(){this._observer&&this._observer.onTilesFell&&this._observer.onTilesFell()},e.prototype.notifyNewTilesAdded=function(){this._observer&&this._observer.onNewTilesAdded&&this._observer.onNewTilesAdded()},e.prototype.notifyShuffled=function(){this._observer&&this._observer.onShuffled&&this._observer.onShuffled()},e.prototype.notifyTileSelected=function(e){this._observer&&this._observer.onTileSelected&&this._observer.onTileSelected(e)},e.prototype.notifyTileDeselected=function(){this._observer&&this._observer.onTileDeselected&&this._observer.onTileDeselected()},e.prototype.notifyBoosterActivated=function(e){this._observer&&this._observer.onBoosterActivated&&this._observer.onBoosterActivated(e)},e.prototype.notifySuperTileCreated=function(e){this._observer&&this._observer.onSuperTileCreated&&this._observer.onSuperTileCreated(e)},e.prototype.notifyBombPlaced=function(e,t){this._observer&&this._observer.onBombPlaced&&this._observer.onBombPlaced(e,t)},e.prototype.notifyBombBoostersChanged=function(){this._observer&&this._observer.onBombBoostersChanged&&this._observer.onBombBoostersChanged(this._bombBoostersLeft)},e.prototype.notifyTeleportBoostersChanged=function(){this._observer&&this._observer.onTeleportBoostersChanged&&this._observer.onTeleportBoostersChanged(this._teleportBoostersLeft)},e.prototype.notifyBoosterHintCleared=function(){this._observer&&this._observer.onBoosterHintCleared&&this._observer.onBoosterHintCleared()},e}();o.GameModel=p,cc._RF.pop()},{"../Enums/BoosterType":"BoosterType","../Enums/ExplosionType":"ExplosionType","../Enums/TileType":"TileType","./GameBoard":"GameBoard","./GameConfig":"GameConfig"}],TileFragment:[function(e,t,o){"use strict";cc._RF.push(t,"89f7fSzhTNLNI2VH3hl1crM","TileFragment");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,a=s.ccclass,c=s.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprite=null,t}return r(t,e),t.prototype.init=function(e,t,o,i,r,n,s){this.sprite||(this.sprite=this.getComponent(cc.Sprite),this.sprite||(this.sprite=this.addComponent(cc.Sprite))),this.sprite.spriteFrame=e,this.node.width=i,this.node.height=r,this.node.x=t,this.node.y=o,this.sprite.type=cc.Sprite.Type.SLICED;var a=this.sprite.spriteFrame.getRect(),c=this.sprite.spriteFrame.getTexture(),l=new cc.SpriteFrame(c,cc.rect(a.x+n,a.y+s,i,r),!1,cc.v2(0,0),cc.size(i,r));this.sprite.spriteFrame=l},t.prototype.playExplosionAnimation=function(e,t,o,i,r){var n=this;cc.tween(this.node).to(i,{scale:.3,opacity:0},{easing:"quadOut"}).start();var s=e,a=t,c=0,l=!1,p=1/60,u=function(){if(c+=p,!l&&c>=.2*i&&r&&(l=!0,r()),c>=i)return n.unschedule(u),void n.node.removeFromParent(!0);a-=1960*p,n.node.x+=s*p,n.node.y+=a*p,n.node.angle+=o*p};this.schedule(u,p),this.node.once("beforeremove",function(){n.unschedule(u)})},n([c(cc.Sprite)],t.prototype,"sprite",void 0),n([a],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],TileType:[function(e,t,o){"use strict";var i;cc._RF.push(t,"cc463QIeGNNTpj2YORPcRJG","TileType"),Object.defineProperty(o,"__esModule",{value:!0}),o.getRandomSuperTileType=o.getRandomTileType=o.isSuperTile=o.isRegularTile=o.TileType=void 0,function(e){e[e.BLUE=0]="BLUE",e[e.GREEN=1]="GREEN",e[e.PURPLE=2]="PURPLE",e[e.RED=3]="RED",e[e.YELLOW=4]="YELLOW",e[e.SUPER_ROW=5]="SUPER_ROW",e[e.SUPER_COLUMN=6]="SUPER_COLUMN",e[e.SUPER_BOMB=7]="SUPER_BOMB",e[e.SUPER_TNT=8]="SUPER_TNT"}(i=o.TileType||(o.TileType={})),o.isRegularTile=function(e){return e<=i.YELLOW},o.isSuperTile=function(e){return e>=i.SUPER_ROW&&e<=i.SUPER_TNT},o.getRandomTileType=function(){var e=[i.BLUE,i.GREEN,i.PURPLE,i.RED,i.YELLOW];return e[Math.floor(Math.random()*e.length)]},o.getRandomSuperTileType=function(){var e=[i.SUPER_ROW,i.SUPER_COLUMN,i.SUPER_BOMB,i.SUPER_TNT];return e[Math.floor(Math.random()*e.length)]},cc._RF.pop()},{}],TileView:[function(e,t,o){"use strict";cc._RF.push(t,"e5f627EwBpB9oh5R5mp0e2k","TileView");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../Enums/TileType"),a=cc._decorator,c=a.ccclass,l=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tileSprites=[],t._row=0,t._col=0,t.sprite=null,t}return r(t,e),t.prototype.onLoad=function(){this.sprite=this.getComponent(cc.Sprite),this.sprite||(this.sprite=this.addComponent(cc.Sprite))},t.prototype.init=function(e,t,o){this._tileType=e,this._row=t,this._col=o,this.updateSprite()},Object.defineProperty(t.prototype,"tileType",{get:function(){return this._tileType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._row},set:function(e){this._row=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._col},set:function(e){this._col=e},enumerable:!1,configurable:!0}),t.prototype.updateSprite=function(){if(this.sprite&&this.tileSprites&&0!==this.tileSprites.length){var e=0;switch(this._tileType){case s.TileType.BLUE:e=0;break;case s.TileType.GREEN:e=1;break;case s.TileType.PURPLE:e=2;break;case s.TileType.RED:e=3;break;case s.TileType.YELLOW:e=4;break;case s.TileType.SUPER_ROW:e=5;break;case s.TileType.SUPER_COLUMN:e=6;break;case s.TileType.SUPER_BOMB:e=7;break;case s.TileType.SUPER_TNT:e=8;break;default:e=0}e>=0&&e<this.tileSprites.length&&(this.sprite.spriteFrame=this.tileSprites[e])}},t.prototype.playFlyToAnimation=function(e,t,o){var i=this,r=this.node.opacity,n=e-this.node.x,s=t-this.node.y,a=Math.sqrt(n*n+s*s),c=Math.min(.5,.2+a/1e3),l=cc.moveTo(c,e,t),p=cc.fadeOut(c),u=cc.spawn(l,p),h=cc.sequence(u,cc.callFunc(function(){i.node.opacity=r,o&&o()}));this.node.runAction(h)},t.prototype.playFallAnimation=function(e,t){var o=Math.abs(this.node.y-e)/800,i=cc.sequence(cc.moveTo(o,this.node.x,e).easing(cc.easeBackIn()),cc.callFunc(function(){t&&t()}));this.node.runAction(i)},t.prototype.playNewTileAnimation=function(e){this.node.scale=0,this.node.opacity=255;var t=cc.sequence(cc.scaleTo(.2,1.1).easing(cc.easeBackOut()),cc.scaleTo(.1,1),cc.callFunc(function(){e&&e()}));this.node.runAction(t)},n([l([cc.SpriteFrame])],t.prototype,"tileSprites",void 0),n([c],t)}(cc.Component);o.default=p,cc._RF.pop()},{"../Enums/TileType":"TileType"}],Tile:[function(e,t,o){"use strict";cc._RF.push(t,"cf653t88XlKcZvdDJQDfV5A","Tile"),Object.defineProperty(o,"__esModule",{value:!0}),o.Tile=void 0;var i=e("../Enums/TileType"),r=function(){function e(e,t,o){this._isMarkedForRemoval=!1,this._isSelected=!1,this._type=e,this._row=t,this._col=o}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"row",{get:function(){return this._row},set:function(e){this._row=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},set:function(e){this._col=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMarkedForRemoval",{get:function(){return this._isMarkedForRemoval},set:function(e){this._isMarkedForRemoval=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){return this._isSelected},set:function(e){this._isSelected=e},enumerable:!1,configurable:!0}),e.prototype.isRegular=function(){return i.isRegularTile(this._type)},e.prototype.isSuperTile=function(){return i.isSuperTile(this._type)},e.prototype.isSameType=function(e){return!(!this.isRegular()||!e.isRegular())&&this._type===e.type},e.prototype.convertToSuperTile=function(e){i.isSuperTile(e)&&(this._type=e)},e}();o.Tile=r,cc._RF.pop()},{"../Enums/TileType":"TileType"}],UIView:[function(e,t,o){"use strict";cc._RF.push(t,"fdae8kidVtO85sn+TMF3KTM","UIView");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../Model/GameConfig"),a=e("../Enums/BoosterType"),c=cc._decorator,l=c.ccclass,p=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scoreLabel=null,t.movesLabel=null,t.bombBoostersLabel=null,t.teleportBoostersLabel=null,t.boosterHintLabel=null,t.gameOverPanel=null,t.gameOverLabel=null,t}return r(t,e),t.prototype.onLoad=function(){this.updateScore(0),this.updateMoves(s.GameConfig.MAX_MOVES),this.updateBombBoosters(s.GameConfig.BOMB_BOOSTERS_COUNT),this.updateTeleportBoosters(s.GameConfig.TELEPORT_BOOSTERS_COUNT),this.clearBoosterHint(),this.gameOverPanel.active=!1,cc.view.on("canvas-resize",this.adaptToScreenSize,this),this.adaptToScreenSize()},t.prototype.adaptToScreenSize=function(){var e=cc.view.getVisibleSize();this.gameOverPanel.width=.8*e.width,this.gameOverPanel.height=.5*e.height},t.prototype.updateScore=function(e){this.scoreLabel.string=e+" / "+s.GameConfig.TARGET_SCORE},t.prototype.updateMoves=function(e){this.movesLabel.string=""+e},t.prototype.updateBombBoosters=function(e){this.bombBoostersLabel.string=""+e},t.prototype.updateTeleportBoosters=function(e){this.teleportBoostersLabel.string=""+e},t.prototype.showGameOver=function(e){this.gameOverPanel.active=!0,this.gameOverLabel.string=e?"\u0412\u044b \u0432\u044b\u0438\u0433\u0440\u0430\u043b\u0438!":"\u0412\u044b \u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043b\u0438!",this.gameOverPanel.scale=0,this.gameOverPanel.opacity=255;var t=cc.sequence(cc.scaleTo(.3,1.1).easing(cc.easeBackOut()),cc.scaleTo(.1,1));this.gameOverPanel.runAction(t)},t.prototype.showBoosterHint=function(e){switch(e){case a.BoosterType.BOMB:this.boosterHintLabel.string="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0430\u0439\u043b\n\u0434\u043b\u044f \u0432\u0437\u0440\u044b\u0432\u0430";break;case a.BoosterType.TELEPORT:this.boosterHintLabel.string="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u0435\u0440\u0432\u044b\u0439\n\u0442\u0430\u0439\u043b \u0434\u043b\u044f \u043e\u0431\u043c\u0435\u043d\u0430";break;default:this.clearBoosterHint()}},t.prototype.updateTeleportSecondHint=function(){this.boosterHintLabel.string="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0442\u043e\u0440\u043e\u0439\n\u0442\u0430\u0439\u043b \u0434\u043b\u044f \u043e\u0431\u043c\u0435\u043d\u0430"},t.prototype.clearBoosterHint=function(){this.boosterHintLabel.string="\u0411\u0423\u0421\u0422\u0415\u0420\u042b"},n([p(cc.Label)],t.prototype,"scoreLabel",void 0),n([p(cc.Label)],t.prototype,"movesLabel",void 0),n([p(cc.Label)],t.prototype,"bombBoostersLabel",void 0),n([p(cc.Label)],t.prototype,"teleportBoostersLabel",void 0),n([p(cc.Label)],t.prototype,"boosterHintLabel",void 0),n([p(cc.Node)],t.prototype,"gameOverPanel",void 0),n([p(cc.Label)],t.prototype,"gameOverLabel",void 0),n([l],t)}(cc.Component);o.default=u,cc._RF.pop()},{"../Enums/BoosterType":"BoosterType","../Model/GameConfig":"GameConfig"}]},{},["BlastGame","GameController","BoosterType","ExplosionType","TileType","Booster","GameBoard","GameConfig","GameModel","Tile","ExplosionManager","GameBoardView","GameLayoutManager","TileFragment","TileView","UIView"]);